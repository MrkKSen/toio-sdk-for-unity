<!DOCTYPE html><html><head><meta charset="utf-8"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css"><style type="text/css">.markdown-body {padding: 20px 40px;}</style><style type="text/css">/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
/*# sourceURL=/Users/yaeda/.nodebrew/node/v14.3.0/lib/node_modules/md-to-pdf/node_modules/highlight.js/styles/github.css*/</style></head>
<body class="markdown-body">
<h1 id="チュートリアルbasic">チュートリアル(Basic)</h1>
<h2 id="目次">目次</h2>
<ul>
<li><a href="tutorials_basic.html#%E3%82%B7%E3%83%BC%E3%83%B3%E4%BD%9C%E6%88%90">シーン作成</a></li>
<li><a href="tutorials_basic.html#%E7%A7%BB%E5%8B%95%E3%81%99%E3%82%8B">移動する</a></li>
<li><a href="tutorials_basic.html#%E9%9F%B3%E3%82%92%E9%B3%B4%E3%82%89%E3%81%99">音を鳴らす</a></li>
<li><a href="tutorials_basic.html#led%E3%82%92%E7%99%BA%E5%85%89%E3%81%99%E3%82%8B">LED を発光する</a></li>
<li><a href="tutorials_basic.html#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E6%A4%9C%E7%9F%A5%E3%83%9C%E3%82%BF%E3%83%B3-%E5%82%BE%E3%81%8D-%E8%A1%9D%E7%AA%81-%E5%BA%A7%E6%A8%99%E3%81%A8%E8%A7%92%E5%BA%A6">イベントを検知(ボタン, 傾き, 衝突, 座標と角度)</a></li>
<li><a href="tutorials_basic.html#%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%AD%E3%83%A5%E3%83%BC%E3%83%96%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99">複数のキューブを動かす</a></li>
<li><a href="tutorials_basic.html#cubemanager%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E7%94%A8%E3%81%84%E3%81%9F%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E7%B0%A1%E7%95%A5%E5%8C%96">ソースコード簡略化</a></li>
<li><a href="tutorials_basic.html#%E9%80%94%E4%B8%AD%E6%8E%A5%E7%B6%9A--%E9%80%94%E4%B8%AD%E5%88%87%E6%96%AD">途中接続/途中切断</a></li>
</ul>
<h2 id="シーン作成">シーン作成</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/0.BasicScene/」 にあります。</p>
</blockquote>
<div align="center"><img width="200" src="../res/tutorial/simplescene.gif"></div>

<h3 id="ステージの配置方法">ステージの配置方法</h3>
<p>以下の手順で基礎環境を構築します。</p>
<ol>
<li>「ファイル &gt; 新しいシーン」をクリックして、新しいシーンを作成します。</li>
<li>ヒエラルキー上から「Main Camera」を削除</li>
<li>「Assets/toio-sdk-unity/Assets/toio-sdk/Scripts/Simulator/Resources」フォルダを開きます。</li>
<li>「Cube」Prefab ファイル と 「Stage」Prefab ファイルをヒエラルキーにドラック&amp;ドロップします。（※シーン上でマウス操作すれば「Cube」オブジェクトの移動も出来ます）</li>
<li>ヒエラルキー上で右クリック、右クリックメニューから「空のオブジェクトを作成」をクリックし、「scene」という名前にします(※名前は自由です)。</li>
<li>「scene」オブジェクトを選択し、インスペクター上から「コンポーネントを追加」をクリックします。</li>
<li>任意のスクリプト名（例 MyScene）を入力して、スクリプトを作成します。</li>
<li>作成したスクリプトを下記サンプルコードに書き換えます。(クラス名はスクリプトファイルと同じ名前にする必要があります)</li>
</ol>
<p>以上を完了させてエディタの再生ボタンを押すと、<a href="download_sdk.html">SDK ダウンロード</a>の最後で再生したサンプルと同じように、キューブが回転し続けます。</p>
<h3 id="サンプルコード">サンプルコード</h3>
<pre><code class="hljs C#"><span class="hljs-keyword">using</span> UnityEngine;
<span class="hljs-keyword">using</span> toio;

<span class="hljs-comment">// ファイル名とクラス名は一致させる必要があります</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BasicScene</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">0.05f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube cube;

    <span class="hljs-comment">// 非同期初期化</span>
    <span class="hljs-comment">// C#標準機能であるasync/awaitキーワードを使用する事で、検索・接続それぞれで終了待ちする</span>
    <span class="hljs-comment">// async: 非同期キーワード</span>
    <span class="hljs-comment">// await: 待機キーワード</span>
    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
          <span class="hljs-comment">// Bluetoothデバイスを検索</span>
        <span class="hljs-keyword">var</span> peripheral = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearestScanner().Scan();
           <span class="hljs-comment">// デバイスへ接続してCube変数を生成</span>
        cube = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripheral);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// Cube変数の生成が完了するまで早期リターン</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == cube) { <span class="hljs-keyword">return</span>; }
        <span class="hljs-comment">// 経過時間を計測</span>
        elapsedTime += Time.deltaTime;

          <span class="hljs-comment">// 前回の命令から50ミリ秒以上経過した場合</span>
        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime)
        {
            elapsedTime = <span class="hljs-number">0.0f</span>;
              <span class="hljs-comment">// 左モーター速度:50, 右モーター速度:-50, 制御時間:200ミリ秒</span>
            cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">200</span>);
        }
    }
}</code></pre><h2 id="移動する">移動する</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/1.Move/」 にあります。</p>
</blockquote>
<div align="center"><img width="200" src="../res/tutorial/movescene.gif"></div>

<p>Cube クラスの Move メソッドでキューブのモーターを制御することが出来ます。</p>
<pre><code class="hljs C#"><span class="hljs-comment">//--------------------------------------------------------</span>
<span class="hljs-comment">// 時間指定付きモーター制御</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_motor#時間指定付きモーター制御</span>
<span class="hljs-comment">//--------------------------------------------------------</span>

<span class="hljs-comment">// left       | 左モーター速度 | 範囲(0~100)</span>
<span class="hljs-comment">// right      | 右モーター速度 | 範囲(0~100)</span>
<span class="hljs-comment">// durationMs | 持続時間　　　 | 範囲(0~2550)</span>
<span class="hljs-comment">// order      | 優先度　　　　 | 種類(Week, Strong)</span>
cube.Move(<span class="hljs-keyword">int</span> left, <span class="hljs-keyword">int</span> right, <span class="hljs-keyword">int</span> durationMs, ORDER_TYPE order=ORDER_TYPE.Weak);</code></pre><details>
<summary>実行コード：（クリック展開）</summary>

<pre><code class="hljs C#"><span class="hljs-comment">// ファイル名とクラス名は一致させる必要があります</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MoveScene</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">2.0f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube cube;
    <span class="hljs-keyword">bool</span> started = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">int</span> phase = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> peripheral = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearestScanner().Scan();
        cube = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripheral);
        started = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">if</span> (!started) <span class="hljs-keyword">return</span>;

        elapsedTime += Time.deltaTime;
        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime) <span class="hljs-comment">// 2秒ごとに実行</span>
        {
            <span class="hljs-keyword">if</span> (phase == <span class="hljs-number">0</span>)
            {
                Debug.Log(<span class="hljs-string">"---------- Phase 0 - 右回転 ----------"</span>);
                <span class="hljs-comment">// 右回転：左モーター指令 50、右モーター指令 -50、継続時間 1500ms</span>
                cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">1500</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (phase == <span class="hljs-number">1</span>)
            {
                Debug.Log(<span class="hljs-string">"---------- Phase 1 - 前進 ----------"</span>);
                <span class="hljs-comment">// MoveRawで前進：左モーター指令 20、右モーター指令 20、継続時間 1500ms</span>
                cube.Move(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">1500</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (phase == <span class="hljs-number">3</span>)
            {
                Debug.Log(<span class="hljs-string">"---------- Phase 3 - 左回り ----------"</span>);
                <span class="hljs-comment">// MoveRawで前進：左モーター指令 100、右モーター指令 70、継続時間 1000ms</span>
                cube.Move(<span class="hljs-number">100</span>, <span class="hljs-number">70</span>, <span class="hljs-number">1800</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (phase == <span class="hljs-number">4</span>)
            {
                Debug.Log(<span class="hljs-string">"---------- Phase 4 - 後進 ----------"</span>);
                <span class="hljs-comment">// MoveRawで前進：左モーター指令 -100、右モーター指令 -100、継続時間 500</span>
                cube.Move(<span class="hljs-number">-100</span>, <span class="hljs-number">-100</span>, <span class="hljs-number">500</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (phase == <span class="hljs-number">5</span>)
            {
                Debug.Log(<span class="hljs-string">"---------- Phase 5 - 左回転 ----------"</span>);
                <span class="hljs-comment">// moveで前進：前進指令 -100、回転指令 100、(希望)継続時間 2000</span>
                cube.Move(<span class="hljs-number">-100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">2000</span>);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (phase == <span class="hljs-number">6</span>)
            {
                Debug.Log(<span class="hljs-string">"---------- 【リセット】 ----------"</span>);
                phase = <span class="hljs-number">-1</span>;
            }

            elapsedTime = <span class="hljs-number">0.0f</span>;
            phase += <span class="hljs-number">1</span>;
        }
    }
}</code></pre></details>

<h2 id="音を鳴らす">音を鳴らす</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/2.Sound/」 にあります。</p>
</blockquote>
<p>Cube クラス PlayPresetSound メソッドでキューブからあらかじめ用意された効果音を再生出来ます。
用意されている効果音については<a href="https://toio.github.io/toio-spec/docs/ble_sound#%E5%8A%B9%E6%9E%9C%E9%9F%B3%E3%81%AE-id">こちら</a>を参照してください。</p>
<pre><code class="hljs C#"><span class="hljs-comment">//--------------------------------------------------------</span>
<span class="hljs-comment">// 効果音の再生</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_sound#効果音の再生</span>
<span class="hljs-comment">//--------------------------------------------------------</span>

<span class="hljs-comment">// soundID | ID    | 範囲(0~10)</span>
<span class="hljs-comment">// volume  | 音量　 | 範囲(0~255)</span>
<span class="hljs-comment">// order   | 優先度 | 種類(Week, Strong)</span>
cube.PlayPresetSound(<span class="hljs-keyword">int</span> soundId, <span class="hljs-keyword">int</span> volume=<span class="hljs-number">255</span>, ORDER_TYPE order=ORDER_TYPE.Strong);</code></pre><p>任意の音を鳴らしたい場合は、 再生したい音を、音符に相当する Cube クラス内の SoundOperation 内部クラスの配列として定義し、それを Cube クラスの PlaySound メソッドで再生させます。</p>
<pre><code class="hljs C#"><span class="hljs-comment">//--------------------------------------------------------</span>
<span class="hljs-comment">// MIDI note numberの再生</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_sound#midi-note-number-の再生</span>
<span class="hljs-comment">//--------------------------------------------------------</span>

<span class="hljs-comment">// durationMs  | 持続時間 | 範囲(10~2550)</span>
<span class="hljs-comment">// volume      | 音量　　 | 範囲(0~255)</span>
<span class="hljs-comment">// note_number | 音符　　 | 範囲(0~128)</span>
<span class="hljs-keyword">new</span> Cube.SoundOperation(Int16 durationMs=<span class="hljs-number">0</span>, <span class="hljs-keyword">byte</span> volume=<span class="hljs-number">0</span>, <span class="hljs-keyword">byte</span> note_number=<span class="hljs-number">0</span>);

<span class="hljs-comment">// repeatCount | 繰り返し回数 | 範囲(0~255)</span>
<span class="hljs-comment">// operations  | 命令配列　　 | 個数(1~59)</span>
<span class="hljs-comment">// order       | 優先度　　　 | 種類(Week, Strong)</span>
cube.PlaySound(<span class="hljs-keyword">int</span> repeatCount, SoundOperation[] operations, ORDER_TYPE order=ORDER_TYPE.Strong);</code></pre><p>※Unity でシミューレータ実行すると音が鳴ります。</p>
<details>
<summary>実行コード：（クリック展開）</summary>

<pre><code class="hljs C#"><span class="hljs-comment">// ファイル名とクラス名は一致させる必要があります</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SoundScene</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">6.0f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube cube;
    <span class="hljs-keyword">bool</span> started = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// Start is called before the first frame update</span>
    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> peripheral = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearestScanner().Scan();
        cube = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripheral);
        <span class="hljs-comment">// 最初にプリセットの音源を再生</span>
        cube.PlayPresetSound(<span class="hljs-number">0</span>);
        started = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// Update is called once per frame</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">if</span> (!started) <span class="hljs-keyword">return</span>;

        elapsedTime += Time.deltaTime;
        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime) <span class="hljs-comment">// 6秒ごとに実行</span>
        {
            elapsedTime = <span class="hljs-number">0.0f</span>;

            <span class="hljs-comment">// カエルの歌の楽譜を作成</span>
            List&lt;Cube.SoundOperation&gt; sound = <span class="hljs-keyword">new</span> List&lt;Cube.SoundOperation&gt;();
            <span class="hljs-comment">// 継続時間(ミリ秒), 音量(0~100), 音符(0~128)</span>
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.C6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.NO_SOUND));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.C6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.NO_SOUND));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.C6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.NO_SOUND));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.C6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.NO_SOUND));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.C6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.D6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.E6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.F6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.E6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.D6));
            sound.Add(<span class="hljs-keyword">new</span> Cube.SoundOperation(durationMs:<span class="hljs-number">300</span>, volume:<span class="hljs-number">15</span>, note_number:Cube.NOTE_NUMBER.C6));
            <span class="hljs-comment">// 楽譜を再生</span>
            cube.PlaySound(<span class="hljs-number">1</span>, sound.ToArray());
        }
    }
}</code></pre></details>

<h2 id="led-を発光する">LED を発光する</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/3.LED/」 にあります。</p>
</blockquote>
<div align="center"><img width="200" src="../res/tutorial/ledscene.gif"></div>

<p>Cube クラスの TurnLedOn メソッドでキューブ底面についている LED を制御することが出来ます。</p>
<pre><code class="hljs C#"><span class="hljs-comment">//--------------------------------------------------------</span>
<span class="hljs-comment">// 点灯・消灯</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_light#点灯-消灯</span>
<span class="hljs-comment">//--------------------------------------------------------</span>

<span class="hljs-comment">// red   | 色の強さ | 範囲(0~255)</span>
<span class="hljs-comment">// green | 色の強さ | 範囲(0~255)</span>
<span class="hljs-comment">// blue  | 色の強さ | 範囲(0~255)</span>
<span class="hljs-comment">// durationMs | 持続時間 | 範囲(10~2550)</span>
<span class="hljs-comment">// order | 優先度　 | 種類(Week, Strong)</span>
cube.TurnLedOn(<span class="hljs-keyword">int</span> red, <span class="hljs-keyword">int</span> green, <span class="hljs-keyword">int</span> blue, <span class="hljs-keyword">int</span> durationMs, ORDER_TYPE order=ORDER_TYPE.Strong);</code></pre><pre><code class="hljs C#"><span class="hljs-comment">//--------------------------------------------------------</span>
<span class="hljs-comment">// 連続的な点灯・消灯</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_light#連続的な点灯-消灯</span>
<span class="hljs-comment">//--------------------------------------------------------</span>

<span class="hljs-comment">// durationMs | 持続時間 | 範囲(10~2550)</span>
<span class="hljs-comment">// red        | 色の強さ | 範囲(0~255)</span>
<span class="hljs-comment">// green      | 色の強さ | 範囲(0~255)</span>
<span class="hljs-comment">// blue       | 色の強さ | 範囲(0~255)</span>
<span class="hljs-keyword">new</span> Cube.LightOperation(Int16 durationMs = <span class="hljs-number">0</span>, <span class="hljs-keyword">byte</span> red = <span class="hljs-number">0</span>, <span class="hljs-keyword">byte</span> green = <span class="hljs-number">0</span>, <span class="hljs-keyword">byte</span> blue = <span class="hljs-number">0</span>);

<span class="hljs-comment">// repeatCount | 繰り返し回数 | 範囲(0~255)</span>
<span class="hljs-comment">// operations  | 命令配列　　 | 個数(1~59)</span>
<span class="hljs-comment">// order       | 優先度　　　 | 種類(Week, Strong)</span>
cube.TurnOnLightWithScenario(<span class="hljs-keyword">int</span> repeatCount, Cube.LightOperation[] operations, ORDER_TYPE order=ORDER_TYPE.Strong)</code></pre><details>
<summary>実行コード：（クリック展開）</summary>

<pre><code class="hljs C#"><span class="hljs-comment">// ファイル名とクラス名は一致させる必要があります</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LEDScene</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">5.0f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube cube;
    <span class="hljs-keyword">bool</span> started = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">// Start is called before the first frame update</span>
    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> peripheral = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearestScanner().Scan();
        cube = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripheral);
        <span class="hljs-comment">// 最初に単発発光命令</span>
        cube.TurnLedOn(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>);
        started = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// Update is called once per frame</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">if</span> (!started) <span class="hljs-keyword">return</span>;

        elapsedTime += Time.deltaTime;

        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime) <span class="hljs-comment">// 5秒ごとに実行</span>
        {
            elapsedTime = <span class="hljs-number">0.0f</span>;
            <span class="hljs-comment">// 発光シナリオ</span>
            List&lt;Cube.LightOperation&gt; scenario = <span class="hljs-keyword">new</span> List&lt;Cube.LightOperation&gt;();
            <span class="hljs-keyword">float</span> rad = (Mathf.Deg2Rad * (<span class="hljs-number">360.0f</span> / <span class="hljs-number">29.0f</span>));
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">29</span>; i++)
            {
                <span class="hljs-keyword">byte</span> r = (<span class="hljs-keyword">byte</span>)Mathf.Clamp((<span class="hljs-number">128</span> + (Mathf.Cos(rad * i) * <span class="hljs-number">128</span>)), <span class="hljs-number">0</span>, <span class="hljs-number">255</span>);
                <span class="hljs-keyword">byte</span> g = (<span class="hljs-keyword">byte</span>)Mathf.Clamp((<span class="hljs-number">128</span> + (Mathf.Sin(rad * i) * <span class="hljs-number">128</span>)), <span class="hljs-number">0</span>, <span class="hljs-number">255</span>);
                <span class="hljs-keyword">byte</span> b = (<span class="hljs-keyword">byte</span>)Mathf.Clamp(((Mathf.Abs(Mathf.Cos(rad * i) * <span class="hljs-number">255</span>))), <span class="hljs-number">0</span>, <span class="hljs-number">255</span>);
                scenario.Add(<span class="hljs-keyword">new</span> Cube.LightOperation(<span class="hljs-number">100</span>, r, g, b));
            }
            cube.TurnOnLightWithScenario(<span class="hljs-number">3</span>, scenario.ToArray());
        }
    }
}</code></pre></details>

<h2 id="イベントを検知ボタン-傾き-衝突-座標と角度">イベントを検知(ボタン, 傾き, 衝突, 座標と角度)</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/4.Event/」 にあります。</p>
</blockquote>
<p>以下のコールバックで、キューブに変化が起きた(イベントを検知した)時の処理を記述することが出来ます。
各イベントについては toio™ コアキューブ技術仕様に準拠していますので、詳しくはそちらを参照してください。</p>
<ul>
<li>ボタンイベント: <a href="https://toio.github.io/toio-spec/docs/ble_button">https://toio.github.io/toio-spec/docs/ble_button</a></li>
<li>傾き、衝突イベント: <a href="https://toio.github.io/toio-spec/docs/ble_sensor">https://toio.github.io/toio-spec/docs/ble_sensor</a></li>
<li>座標角度イベント: <a href="https://toio.github.io/toio-spec/docs/ble_id">https://toio.github.io/toio-spec/docs/ble_id</a><ul>
<li>このイベントを検知するには、トイオ・コレクションのマット上でキューブを動かす必要があります。</li>
</ul>
</li>
</ul>
<pre><code class="hljs C#"><span class="hljs-comment">// ボタンイベント</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_button</span>
cube.buttonCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnPressButton);
<span class="hljs-comment">// 傾きイベント</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_sensor#水平検出</span>
cube.slopeCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnSlope);
<span class="hljs-comment">// 衝突イベント</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_sensor#衝突検出</span>
cube.collisionCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnCollision);
<span class="hljs-comment">// 座標角度イベント</span>
<span class="hljs-comment">// https://toio.github.io/toio-spec/docs/ble_id#position-id</span>
cube.idCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnUpdateID);</code></pre><p>※イベントの検知はシミュレータ上では出来ません。 現実のキューブを使った場合にのみ動作します。</p>
<details>
<summary>実行コード：（クリック展開）</summary>

<pre><code class="hljs C#"><span class="hljs-comment">// ファイル名とクラス名は一致させる必要があります</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EventScene</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">0.05f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube cube;
    <span class="hljs-keyword">bool</span> showId = <span class="hljs-literal">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> peripheral = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearestScanner().Scan();
        cube = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripheral);
        <span class="hljs-comment">// コールバック登録</span>
        cube.buttonCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnPressButton);
        cube.slopeCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnSlope);
        cube.collisionCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnCollision);
        cube.idCallback.AddListener(<span class="hljs-string">"EventScene"</span>, OnUpdateID);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {

    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnCollision</span>(<span class="hljs-params">Cube c</span>)</span>
    {
        cube.PlayPresetSound(<span class="hljs-number">2</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnSlope</span>(<span class="hljs-params">Cube c</span>)</span>
    {
        cube.PlayPresetSound(<span class="hljs-number">8</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnPressButton</span>(<span class="hljs-params">Cube c</span>)</span>
    {
        <span class="hljs-keyword">if</span> (c.isPressed)
        {
            showId = !showId;
        }
        cube.PlayPresetSound(<span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnUpdateID</span>(<span class="hljs-params">Cube c</span>)</span>
    {
        <span class="hljs-keyword">if</span> (showId)
        {
            Debug.LogFormat(<span class="hljs-string">"pos=(x:{0}, y:{1}), angle={2}"</span>, c.pos.x, c.pos.y, c.angle);
        }
    }
}</code></pre></details>

<h2 id="複数のキューブを動かす">複数のキューブを動かす</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/5.MultiCube/」 にあります。</p>
</blockquote>
<div align="center"><img width="200" src="../res/tutorial/multicube.gif"></div>

<p>これまでのサンプルコードでは 1 台のキューブに接続していました。<br>
スキャン部分を以下のコードに変更すると、複数台のキューブに接続が可能になります。</p>
<pre><code class="hljs C#"><span class="hljs-comment">// 最大12台のCubeを検索</span>
<span class="hljs-keyword">var</span> peripherals = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearScanner(<span class="hljs-number">12</span>).Scan();
<span class="hljs-comment">// 検索したCubeに接続</span>
cubes = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripherals);</code></pre><details>
<summary>実行コード：（クリック展開）</summary>

<pre><code class="hljs C#"><span class="hljs-comment">// ファイル名とクラス名は一致させる必要があります</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MultiCubeScene</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">0.05f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube[] cubes;
    <span class="hljs-keyword">bool</span> started = <span class="hljs-literal">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> peripherals = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearScanner(<span class="hljs-number">12</span>).Scan();
        cubes = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripherals);
        started = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">if</span> (!started) { <span class="hljs-keyword">return</span>; }

        elapsedTime += Time.deltaTime;
        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime)
        {
            elapsedTime = <span class="hljs-number">0.0f</span>;
            <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> cube <span class="hljs-keyword">in</span> cubes)
            {
                cube.Move(<span class="hljs-number">60</span>, <span class="hljs-number">20</span>, <span class="hljs-number">200</span>);
            }
        }
    }
}</code></pre></details>

<h2 id="cubemanager-クラスを用いたソースコードの簡略化">CubeManager クラスを用いたソースコードの簡略化</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/6.CubeManager/」 にあります。</p>
</blockquote>
<p>これまでのサンプルでは</p>
<ul>
<li>Scan と Connect</li>
<li>cube 変数</li>
<li>started という初期化完了フラグ</li>
<li>時間制御変数</li>
</ul>
<p>などを用意していました。しかし、toio のプログラムを作る度に毎回似たようなコードを書く必要があります。CubeManager クラスを使うと、これらの定型的な処理を簡略化する事が出来ます。</p>
<h3 id="一台接続">一台接続</h3>
<div align="center"><img width="200" src="../res/tutorial/cm_single.gif"></div>

<h4 id="簡略前">簡略前</h4>
<pre><code class="hljs C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CubeManagerScene_RawSingle</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">0.05f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube cube;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// モジュールを直接利用した場合:</span>
        <span class="hljs-keyword">var</span> peripheral = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearestScanner().Scan();
        cube = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripheral);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// モジュールを直接利用した場合:</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == cube) { <span class="hljs-keyword">return</span>; }
        elapsedTime += Time.deltaTime;
        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime)
        {
            elapsedTime = <span class="hljs-number">0.0f</span>;
            cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">200</span>);
        }
    }
}</code></pre><h4 id="簡略後">簡略後</h4>
<pre><code class="hljs C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CubeManagerScene_Single</span> : <span class="hljs-title">MonoBehaviour</span>
{
    CubeManager cubeManager;
    Cube cube;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// CubeManagerからモジュールを間接利用した場合:</span>
        cubeManager = <span class="hljs-keyword">new</span> CubeManager();
        cube = <span class="hljs-keyword">await</span> cubeManager.SingleConnect();
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// CubeManagerからモジュールを間接利用した場合:</span>
        <span class="hljs-keyword">if</span> (cubeManager.IsControllable(cube))
        {
            cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">200</span>);
        }
    }
}</code></pre><h3 id="複数台接続">複数台接続</h3>
<div align="center"><img width="200" src="../res/tutorial/cm_multi.gif"></div>

<h4 id="簡略前-1">簡略前</h4>
<pre><code class="hljs C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CubeManagerScene_RawMulti</span> : <span class="hljs-title">MonoBehaviour</span>
{
    <span class="hljs-keyword">float</span> intervalTime = <span class="hljs-number">0.05f</span>;
    <span class="hljs-keyword">float</span> elapsedTime = <span class="hljs-number">0</span>;
    Cube[] cubes;
    <span class="hljs-keyword">bool</span> started = <span class="hljs-literal">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// モジュールを直接利用した場合:</span>
        <span class="hljs-keyword">var</span> peripherals = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> NearScanner(<span class="hljs-number">12</span>).Scan();
        cubes = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> CubeConnecter().Connect(peripherals);
        started = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// モジュールを直接利用した場合:</span>
        <span class="hljs-keyword">if</span> (!started) { <span class="hljs-keyword">return</span>; }
        elapsedTime += Time.deltaTime;
        <span class="hljs-keyword">if</span> (intervalTime &lt; elapsedTime)
        {
            elapsedTime = <span class="hljs-number">0.0f</span>;
            <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> cube <span class="hljs-keyword">in</span> cubes)
            {
                cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">200</span>);
            }
        }
    }
}</code></pre><h4 id="簡略後-1">簡略後</h4>
<pre><code class="hljs C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CubeManagerScene_Multi</span> : <span class="hljs-title">MonoBehaviour</span>
{
    CubeManager cubeManager;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// CubeManagerからモジュールを間接利用した場合:</span>
        cubeManager = <span class="hljs-keyword">new</span> CubeManager();
        <span class="hljs-keyword">await</span> cubeManager.MultiConnect(<span class="hljs-number">12</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-comment">// CubeManagerからモジュールを間接利用した場合:</span>
        <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> cube <span class="hljs-keyword">in</span> cubeManager.cubes)
        {
            <span class="hljs-keyword">if</span> (cubeManager.IsControllable(cube))
            {
                cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">200</span>);
            }
        }
    }
}</code></pre><h2 id="途中接続--途中切断">途中接続 / 途中切断</h2>
<blockquote>
<p>※ この章のサンプルファイルは、「Assets/toio-sdk/Tutorials/1.Basic/6.CubeManager/」 にあります。</p>
</blockquote>
<p>NearScanner クラスの ScanAsync メソッドを呼ぶ事で、非同期検索が出来るようになります。</p>
<pre><code class="hljs C#">nearScanner.ScanAsync(coroutineObject, callback, autoRunning);</code></pre><p>NearScanner クラスを直接利用した場合様々な処理を追加する必要がありますが、<br>
CubeManager クラス内部で必要な処理を実行する事により、<br>
分かりやすい形で非同期に接続/切断を実装する事が出来ます。</p>
<pre><code class="hljs C#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CubeManagerScene_MultiAsync</span> : <span class="hljs-title">MonoBehaviour</span>
{
    CubeManager cubeManager;

    <span class="hljs-function"><span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Start</span>(<span class="hljs-params"></span>)</span>
    {
        cubeManager = <span class="hljs-keyword">new</span> CubeManager();
        <span class="hljs-comment">// 任意のタイミングで非同期接続</span>
        cubeManager.MultiConnectAsync(
            cubeNum:<span class="hljs-number">4</span>,
            coroutineObject:<span class="hljs-keyword">this</span>,
            connectedAction:OnConnected
        );
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> cube <span class="hljs-keyword">in</span> cubeManager.cubes)
        {
            <span class="hljs-keyword">if</span> (cubeManager.IsControllable(cube))
            {
                cube.Move(<span class="hljs-number">50</span>, <span class="hljs-number">-50</span>, <span class="hljs-number">200</span>);
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">OnConnected</span>(<span class="hljs-params">Cube cube, CONNECTION_STATUS status</span>)</span>
    {
        <span class="hljs-keyword">if</span> (status.IsNewConnected)
        {
            Debug.Log(<span class="hljs-string">"new-connected!!"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.IsReConnected)
        {
            Debug.Log(<span class="hljs-string">"re-connected!!"</span>);
        }
    }
}</code></pre>


</body></html>
