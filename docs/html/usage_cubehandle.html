<!DOCTYPE html><html><head><meta charset="utf-8"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css"><style type="text/css">.markdown-body {padding: 20px 40px;}</style><style type="text/css">/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
/*# sourceURL=/Users/yaeda/.nodebrew/node/v14.3.0/lib/node_modules/md-to-pdf/node_modules/highlight.js/styles/github.css*/</style></head>
<body class="markdown-body">
<h1 id="目次">目次</h1>
<ul>
<li><a href="usage_cubehandle.html#1-%E6%A6%82%E8%AA%AC">1. 概説</a></li>
<li><a href="usage_cubehandle.html#2-CubeHandle%E3%82%AF%E3%83%A9%E3%82%B9API">2. CubeHandle クラス API</a><ul>
<li><a href="usage_cubehandle.html#21-%E5%A4%89%E6%95%B0">2.1. 変数</a></li>
<li><a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">2.2. Movement 構造体</a></li>
<li><a href="usage_cubehandle.html#23-%E5%9F%BA%E6%9C%AC%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89">2.3. 基本メソッド</a></li>
<li><a href="usage_cubehandle.html#24-One-Shot-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89">2.4. One-Shot メソッド</a></li>
<li><a href="usage_cubehandle.html#25-Closed-Loop-%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89">2.5. Closed-Loop メソッド</a></li>
</ul>
</li>
</ul>
<h1 id="1-概説">1. 概説</h1>
<p>Cube クラスには toio の仕様通りに基礎機能が実装されています。<br>
それに対し、プログラムからキューブの移動操作をより簡単にできるようにしたのが CubeHandle クラスです。</p>
<p>CubeHandle インスタンスは Cube インスタンスと一対一対応するもので、 Cube を使ってインスタンス化されます。</p>
<pre><code class="hljs c#">Cube cube = ...
CubeHandle handle = <span class="hljs-keyword">new</span> CubeHandle(cube);</code></pre><p>CubeHandle の内部の構造と Cube とのやり取りは以下の制御ブロック図で示されています。</p>
<div align="center">
  <img src="../res/cubehandle/arch.png" title="CubeHandle 制御ブロック図">
</div>

<p>情報の流れに沿って説明すると</p>
<ol>
<li>Cube の状態（座標と角度）が Update メソッドによって CubeHandle に取り込まれると、まず予測モジュールに入り、
現在速度やラグ後の状態などを推算します</li>
<li>予測結果と Cube の状態と合わせて、制御メソッドに入ります</li>
<li>一つのルートは、ユーザーが指定した目標（座標や角度など）を、
相応の制御メソッド（例えば Move2Target）に渡し、Movement を出力し Move メソッドに渡します</li>
<li>Move メソッドは 3. の Move2Target メソッドの出力した Movement を受けるか、
或いはもう一つのオーバーロードで、
ユーザーの指定した前進指示値と回転指示値と継続時間とを受けて、
デッドゾーン処理とボーダー制限をかけて、Cube.Move メソッドの入力と同じ形式の
左右指示値と継続時間に変換して、MoveRaw メソッドに渡します</li>
<li>MoveRaw メソッドは Cube.Move メソッドと同じ入力形式を持ち、
指示値を弄ったりもせず、ただ単に指令値を予測モジュールに保存させて、
そして Cube.Move メソッドに渡して実行させます</li>
</ol>
<br>

<h1 id="2-cubehandle-クラス-api">2. CubeHandle クラス API</h1>
<p>CubeHandle クラスを使ったサンプルなどは<a href="tutorials_cubehandle.html">チュートリアル</a>で紹介しています。 そちらも参照してください。</p>
<h2 id="21-変数">2.1. 変数</h2>
<h3 id="定数">定数</h3>
<pre><code class="hljs c#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> TireWidthDot { <span class="hljs-keyword">get</span>; }      <span class="hljs-comment">// 左右車輪の間隔（マット座標）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> VDotOverU { <span class="hljs-keyword">get</span>; }         <span class="hljs-comment">// 速度と指示値の比例 (dot/sec) / cmd</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> DotPerM { <span class="hljs-keyword">get</span>; }           <span class="hljs-comment">// マット単位とメートルの比例 dot / mm</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">float</span> MotorTau = <span class="hljs-number">0.04f</span>;  <span class="hljs-comment">// モーターの一次遅れ要素 sec</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> Deadzone { <span class="hljs-keyword">get</span>; }                 <span class="hljs-comment">// モーター指示値のデッドゾーン（実例化の際固定される）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> MaxSpd { <span class="hljs-keyword">get</span>; }                      <span class="hljs-comment">// 最大速度指示値（実例化の際固定される）</span></code></pre><h3 id="パラメーター">パラメーター</h3>
<pre><code class="hljs c#"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> dt = <span class="hljs-number">1.0</span> / <span class="hljs-number">60</span> * <span class="hljs-number">3</span>;     <span class="hljs-comment">// 制御の周期 50ms</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> lag = <span class="hljs-number">0.130</span>;           <span class="hljs-comment">// ラグ</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> CenterX = <span class="hljs-number">250</span>;   <span class="hljs-comment">// マットの中央のｘ座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> CenterY = <span class="hljs-number">250</span>;   <span class="hljs-comment">// マットの中央のｙ座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SizeX = <span class="hljs-number">410</span>;     <span class="hljs-comment">// マットのｘ軸方向のサイズ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SizeY = <span class="hljs-number">410</span>;     <span class="hljs-comment">// マットのｙ軸方向のサイズ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> RangeX = <span class="hljs-number">370</span>;    <span class="hljs-comment">// マットのｘ軸方向の行動範囲（Moveのボーダー制限用）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> RangeY = <span class="hljs-number">370</span>;    <span class="hljs-comment">// マットのｙ軸方向の行動範囲（Moveのボーダー制限用）</span></code></pre><h3 id="プロパティ">プロパティ</h3>
<pre><code class="hljs c#"><span class="hljs-comment">// 現在状態</span>
<span class="hljs-keyword">public</span> Cube cube { <span class="hljs-keyword">get</span>; }   <span class="hljs-comment">// キューブ</span>
<span class="hljs-keyword">public</span> Vector pos { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// 座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> x { <span class="hljs-keyword">get</span>; }    <span class="hljs-comment">// ｘ座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> y { <span class="hljs-keyword">get</span>; }    <span class="hljs-comment">// ｙ座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> rad { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// 弧度</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> deg { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// 角度（度）</span>
<span class="hljs-keyword">public</span> Vector dir { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// 単位方向ベクトル</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> lagMS { <span class="hljs-keyword">get</span>; }   <span class="hljs-comment">// ラグ（ms）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> dtMS { <span class="hljs-keyword">get</span>; }    <span class="hljs-comment">// 制限の周期（ms）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> touch { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// タッチ状態（リアルだけ有効）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> lost { <span class="hljs-keyword">get</span>; }   <span class="hljs-comment">// ロスト状態（リアルだけ有効）</span>

<span class="hljs-comment">// 予測結果</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> spdL, spdR;       <span class="hljs-comment">// 現在左右タイヤの速度</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> radPred, xPred, yPred, spdPredL, spdPredR;    <span class="hljs-comment">// ラグ後の弧度、ｘｙ座標、左右速度</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> stopRadPred, stopXPred, stopYPred;    <span class="hljs-comment">// 停止指示を出す場合、停止した後の弧度、ｘｙ座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> spd { <span class="hljs-keyword">get</span>; }      <span class="hljs-comment">// 現在速度大きさ</span>
<span class="hljs-keyword">public</span> Vector v { <span class="hljs-keyword">get</span>; }        <span class="hljs-comment">// 現在速度ベクトル</span>
<span class="hljs-keyword">public</span> Vector posPred { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// ラグ後の座標</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> spdPred { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// ラグ後の速度大きさ</span>
<span class="hljs-keyword">public</span> Vector vPred { <span class="hljs-keyword">get</span>; }    <span class="hljs-comment">// ラグ後の速度ベクトル</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> wPred { <span class="hljs-keyword">get</span>; }    <span class="hljs-comment">// ラグ後の角速度</span>
<span class="hljs-keyword">public</span> Vector stopPosPred { <span class="hljs-keyword">get</span>; }  <span class="hljs-comment">// 停止指示を出す場合、停止した後の座標</span></code></pre><br>

<h2 id="22-movement-構造体">2.2. Movement 構造体</h2>
<p>Movement 構造体は使いやすくするため、制御メソッドの出力を統合した構造体です。</p>
<h3 id="変数">変数</h3>
<pre><code class="hljs c#"><span class="hljs-keyword">public</span> CubeHandle handle;   <span class="hljs-comment">// 誰の指示か</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> translate;    <span class="hljs-comment">// 前進速度指示値</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> rotate;       <span class="hljs-comment">// 回転速度指示値</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> durationMs;      <span class="hljs-comment">// 継続時間（ms）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> reached;        <span class="hljs-comment">// 制御メソッド完了したか</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> idle;           <span class="hljs-comment">// この Movement が実行されるか</span></code></pre><h3 id="メソッド">メソッド</h3>
<h4 id="exec">Exec</h4>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Exec</span>(<span class="hljs-params"></span>)</span>;</code></pre><p>メンバー変数 handle の Move を呼んで実行します</p>
<br>

<h2 id="23-基本メソッド">2.3. 基本メソッド</h2>
<h3 id="update">Update</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"></span>)</span>;</code></pre><p>状態更新、移動先の予測をします</p>
<p>このメソッドは MoveRaw 以外のメソッドを実行するフレームで、それらを実行する前に一回実行する必要があります。</p>
<h3 id="moveraw">MoveRaw</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MoveRaw</span>(<span class="hljs-params">
  <span class="hljs-keyword">double</span> uL, <span class="hljs-keyword">double</span> uR,
  <span class="hljs-keyword">int</span> durationMs = <span class="hljs-number">1000</span>,
  Cube.ORDER_TYPE order = Cube.ORDER_TYPE.Weak
  </span>)</span>;</code></pre><p>キューブを移動させます</p>
<ul>
<li>uL<ul>
<li>定義：左モーター速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -100 ~ -10； -9 ~ 9 は 0 に等価； 10 ~ 100</li>
<li>[Version 2.1.0] -115 ~ -8； -7 ~ 7 は 0 に等価； 8 ~ 115</li>
</ul>
</li>
</ul>
</li>
<li>uR<ul>
<li>定義：右モーター速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -100 ~ -10； -9 ~ 9 は 0 に等価； 10 ~ 100</li>
<li>[Version 2.1.0] -115 ~ -8； -7 ~ 7 は 0 に等価； 8 ~ 115</li>
</ul>
</li>
</ul>
</li>
<li>durationMS<ul>
<li>定義：継続時間（ms）</li>
<li>範囲：<ul>
<li>0~5 は「時間制限なし」ではなく、10ms の停止命令を代わりに送信</li>
<li>6~9 は「時間制限なし」ではなく、10ms に修正する</li>
<li>10~2550 （精度は 10ms、1 位が省略される）</li>
</ul>
</li>
<li>既定値：1000</li>
</ul>
</li>
<li>order<ul>
<li>定義 : <a href="sys_cube.html#4-%E5%91%BD%E4%BB%A4%E9%80%81%E4%BF%A1">命令の優先度</a></li>
<li>種類 : Weak, Strong</li>
<li>既定値：Weak</li>
</ul>
</li>
</ul>
<h3 id="move">Move</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move</span>(<span class="hljs-params">
    <span class="hljs-keyword">double</span> translate,           // 前進速度の指示値
    <span class="hljs-keyword">double</span> rotate,              // 回転速度の指示値
    <span class="hljs-keyword">int</span> durationMs = <span class="hljs-number">1000</span>,      // 継続時間（ms）
    <span class="hljs-keyword">bool</span> border = <span class="hljs-literal">true</span>,         // ボーダー制限のありなし
    Cube.ORDER_TYPE order = Cube.ORDER_TYPE.Weak    // 指示の優先度
    </span>)</span>;</code></pre><p>キューブを移動させます</p>
<ul>
<li>translate<ul>
<li>定義：前進速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -100+Abs(rotate)/2 ~ 100-Abs(rotate)/2</li>
<li>[Version 2.1.0] -115+Abs(rotate)/2 ~ 115-Abs(rotate)/2</li>
</ul>
</li>
<li>説明：左右モーター指示値（uL, uR）との関係は、<code>translate = (uL + uR)/2</code></li>
</ul>
</li>
<li>rotate<ul>
<li>定義：回転速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -100+Abs(rotate)/2 ~ 100-Abs(rotate)/2</li>
<li>[Version 2.1.0] -115+Abs(rotate)/2 ~ 115-Abs(rotate)/2</li>
</ul>
</li>
<li>説明：左右モーター指示値（uL, uR）との関係は、<code>rotate = uL - uR</code></li>
</ul>
</li>
<li>durationMS<ul>
<li>定義：継続時間（ms）</li>
<li>範囲：<ul>
<li>0~5 は「時間制限なし」ではなく、10ms の停止命令を代わりに送信</li>
<li>6~9 は「時間制限なし」ではなく、10ms に修正する</li>
<li>10~2550 （精度は 10ms、1 位が省略される）</li>
</ul>
</li>
<li>既定値：1000</li>
<li>説明：ボーダー制限によって小さくなる可能性がある</li>
</ul>
</li>
<li>border<ul>
<li>定義：ボーダー制限のありなし</li>
<li>説明：ボーダーの範囲は CubeHanlde のパブリック変数で設定できます。<br>
<code>public int RangeX = 370;</code> <code>public int RangeY = 370;</code></li>
</ul>
</li>
<li>order<ul>
<li>定義 : <a href="sys_cube.html#4-%E5%91%BD%E4%BB%A4%E9%80%81%E4%BF%A1">命令の優先度</a></li>
<li>種類 : Weak, Strong</li>
<li>既定値：Weak</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：実際に実行された <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">Movement</a></li>
</ul>
</li>
</ul>
<h4 id="overloads">Overloads</h4>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move</span>(<span class="hljs-params">
  Movement mv,
  <span class="hljs-keyword">bool</span> border = <span class="hljs-literal">true</span>,
  Cube.ORDER_TYPE order = Cube.ORDER_TYPE.Weak
  </span>)</span>;</code></pre><p><a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">Movement</a> を実行します</p>
<ul>
<li>mv<ul>
<li>定義：移動命令</li>
</ul>
</li>
<li>border<ul>
<li>定義：ボーダー制限のありなし</li>
</ul>
</li>
<li>order<ul>
<li>定義 : <a href="sys_cube.html#4-%E5%91%BD%E4%BB%A4%E9%80%81%E4%BF%A1">命令の優先度</a></li>
<li>種類 : Weak, Strong</li>
<li>既定値：Weak</li>
</ul>
</li>
</ul>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move</span>(<span class="hljs-params">
  Movement mv,
  <span class="hljs-keyword">int</span> durationMs,
  <span class="hljs-keyword">bool</span> border = <span class="hljs-literal">true</span>,
  Cube.ORDER_TYPE order = Cube.ORDER_TYPE.Weak
</span>)</span>;</code></pre><p><a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">Movement</a> の継続時間を書き換えて実行します</p>
<ul>
<li>mv<ul>
<li>定義：移動命令</li>
</ul>
</li>
<li>durationMS<ul>
<li>定義：継続時間（ms）</li>
</ul>
</li>
<li>border<ul>
<li>定義：ボーダー制限のありなし</li>
</ul>
</li>
<li>order<ul>
<li>定義 : <a href="sys_cube.html#4-%E5%91%BD%E4%BB%A4%E9%80%81%E4%BF%A1">命令の優先度</a></li>
<li>種類 : Weak, Strong</li>
<li>既定値：Weak</li>
</ul>
</li>
</ul>
<h3 id="stop">Stop</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Stop</span>(<span class="hljs-params"></span>)</span>;</code></pre><p>キューブを停止させます</p>
<p>moveRaw(0,0,100,Cube.ORDER_TYPE.Strong) と等価です。</p>
<br>

<h2 id="24-one-shot-メソッド">2.4. One-Shot メソッド</h2>
<p>CubeHandle クラスの Closed-loop メソッドは目的に到達するために何度も繰り返し実行する想定です。 処理を実行するたびにキューブと Bluetooth 通信をすることなるため、 移動しながら LED を点滅したり、音を鳴らしたりすると通信量が多くなりすぎてしまいます。</p>
<p>One-shot メソッドはこの問題を解決するための機能で、 目標に達するために一回だけ呼び出せば良いので移動をするのに必要な通信量を抑えることが出来ます。
（Open-Loop なので、結果の保証はありません）</p>
<h3 id="translatebydist">TranslateByDist</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">TranslateByDist</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> dist, <span class="hljs-keyword">double</span> translate</span>)</span>;</code></pre><p>指定距離を指定速度で前進・後退する Movement を計算します</p>
<ul>
<li>dist<ul>
<li>定義：距離</li>
<li>範囲：-2.55 _ Abs(translate) _ <code>VDotOverU</code> ~ 2.55 _ Abs(translate) _ <code>VDotOverU</code></li>
</ul>
</li>
<li>translate<ul>
<li>定義：前進速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -100<del>-10； 10</del>100</li>
<li>[Version 2.1.0] -115<del>-8； 8</del>115</li>
</ul>
</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>
<h3 id="rotatebyrad">RotateByRad</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">RotateByRad</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> drad, <span class="hljs-keyword">double</span> rotate</span>)</span>;</code></pre><p>指定角度（弧度）を指定回転速度で回転する Movement を計算します</p>
<ul>
<li>drad<ul>
<li>定義：角度（弧度）</li>
<li>範囲：-2.55 _ Abs(rotate) _ <code>VDotOverU</code>/<code>TireWidthDot</code> ~ 2.55 _ Abs(rotate) _ <code>VDotOverU</code>/<code>TireWidthDot</code></li>
</ul>
</li>
<li>rotate<ul>
<li>定義：回転速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -200<del>-20； 20</del>200</li>
<li>[Version 2.1.0] -230<del>-16； 16</del>230</li>
</ul>
</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>
<h3 id="rotatebydeg">RotateByDeg</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">RotateByDeg</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> ddeg, <span class="hljs-keyword">double</span> rotate</span>)</span></code></pre><p>指定角度（度）を指定回転速度で回転する Movement を計算します</p>
<ul>
<li>drad<ul>
<li>定義：角度（度）</li>
<li>範囲：-2.55 _ Abs(rotate) _ <code>VDotOverU</code>/<code>TireWidthDot</code>_180/pi<br>
~ 2.55 _ Abs(rotate) * <code>VDotOverU</code>/<code>TireWidthDot</code>*180/pi</li>
</ul>
</li>
<li>rotate<ul>
<li>定義：回転速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] -200<del>-20； 20</del>200</li>
<li>[Version 2.1.0] -230<del>-16； 16</del>230</li>
</ul>
</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>
<br>

<h2 id="25-closed-loop-メソッド">2.5. Closed-Loop メソッド</h2>
<p>繰り返し実行し続けることで、マットの指定した座標、指定した方向に到達するのが Closed-Loop メソッドです。</p>
<p>One-Shot メソッドと異なり 目標を追い続け、結果が保証されますが、高頻度にキューブと通信をするので送信量が多くなります。</p>
<h3 id="move2target">Move2Target</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move2Target</span>(<span class="hljs-params">
    <span class="hljs-keyword">double</span> tarX,            // 目標ｘ座標
    <span class="hljs-keyword">double</span> tarY,            // 目標ｙ座標
    <span class="hljs-keyword">double</span> maxSpd = <span class="hljs-number">50</span>,     // 最大速度の指示値
    <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">250</span>,   // 希望回転時間（ms）
    <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">8</span>    // 到達判定の閾値
    </span>)</span>;</code></pre><p>目標座標に移動する Movement を計算します</p>
<ul>
<li>tarX<ul>
<li>定義：目標ｘ座標</li>
<li>範囲：任意</li>
</ul>
</li>
<li>tarY<ul>
<li>定義：目標ｘ座標</li>
<li>範囲：任意</li>
</ul>
</li>
<li>maxSpd<ul>
<li>定義：最大速度の指示値</li>
<li>範囲：<ul>
<li>[Version 2.0.0] 0~100</li>
<li>[Version 2.1.0] 0~115</li>
</ul>
</li>
<li>既定値：50</li>
<li>説明：目標に近づくや回転する具合によって減速する。</li>
</ul>
</li>
<li>rotateTime<ul>
<li>定義：希望回転時間（ms）</li>
<li>範囲：100 ~ 2550</li>
<li>既定値：250</li>
<li>説明：rotateTime で目標に向けるように回転指示値を出す。<br>
小さい値を入れると早く回転し、大きな値を入れるとゆっくりと回転します。正確な回転時間ではなく、だいたいの目安です。<br>
200 以下になると不安定になる可能性があります。</li>
</ul>
</li>
<li>tolerance<ul>
<li>定義：到達判定の閾値（距離）</li>
<li>既定値：8</li>
<li>説明：目標との距離が tolerance 以下になると、到達だと判断する。</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>
<h4 id="overloads-1">Overloads</h4>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move2Target</span>(<span class="hljs-params">Vector pos, <span class="hljs-keyword">double</span> maxSpd = <span class="hljs-number">50</span>, <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">250</span>, <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">8</span></span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move2Target</span>(<span class="hljs-params">Vector2 pos, <span class="hljs-keyword">double</span> maxSpd = <span class="hljs-number">50</span>, <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">250</span>, <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">8</span></span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Move2Target</span>(<span class="hljs-params">Vector2Int pos, <span class="hljs-keyword">double</span> maxSpd = <span class="hljs-number">50</span>, <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">250</span>, <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">8</span></span>)</span></code></pre><ul>
<li>pos<ul>
<li>定義：目標座標</li>
</ul>
</li>
</ul>
<h3 id="rotate2rad">Rotate2Rad</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Rotate2Rad</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> tarRad, <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">400</span>, <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">0.1</span></span>)</span>;</code></pre><p>指定角度（弧度）に回転する Movement を計算します</p>
<ul>
<li>tarRad<ul>
<li>定義：目標角度（弧度）</li>
<li>範囲：任意</li>
</ul>
</li>
<li>rotateTime<ul>
<li>定義：希望回転時間（ms）</li>
<li>範囲：100 ~ 2550</li>
<li>既定値：400</li>
</ul>
</li>
<li>tolerance<ul>
<li>定義：到達判定の閾値（弧度）</li>
<li>既定値：0.1</li>
<li>説明：目標角度（弧度）と差が tolerance 以下になると、到達だと判断する。</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>
<h3 id="rotate2deg">Rotate2Deg</h3>
<pre><code class="hljs c#"><span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Rotate2Deg</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> tarDeg, <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">400</span>, <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">5</span></span>)</span>;</code></pre><p>指定角度（度）に回転する Movement を計算します</p>
<ul>
<li>tarRad<ul>
<li>定義：目標角度（度）</li>
<li>範囲：任意</li>
</ul>
</li>
<li>rotateTime<ul>
<li>定義：希望回転時間（ms）</li>
<li>範囲：100 ~ 2550</li>
<li>既定値：400</li>
</ul>
</li>
<li>tolerance<ul>
<li>定義：到達判定の閾値（度）</li>
<li>既定値：5</li>
<li>説明：目標角度（度）と差が tolerance 以下になると、到達だと判断する。</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>
<h3 id="rotate2target">Rotate2Target</h3>
<pre><code class="hljs c#"><span class="hljs-comment">// tarX, tarY 指定座標、tolerance 到達判定の閾値(弧度)、rotateTime 希望回転時間（ms）</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Movement <span class="hljs-title">Rotate2Target</span>(<span class="hljs-params"><span class="hljs-keyword">double</span> tarX, <span class="hljs-keyword">double</span> tarY, <span class="hljs-keyword">int</span> rotateTime = <span class="hljs-number">400</span>, <span class="hljs-keyword">double</span> tolerance = <span class="hljs-number">0.1</span></span>)</span>;</code></pre><p>指定座標の方向に回転する Movement を計算します</p>
<ul>
<li>tarX<ul>
<li>定義：目標ｘ座標</li>
<li>範囲：任意</li>
</ul>
</li>
<li>tarY<ul>
<li>定義：目標ｙ座標</li>
<li>範囲：任意</li>
</ul>
</li>
<li>rotateTime<ul>
<li>定義：希望回転時間（ms）</li>
<li>範囲：100 ~ 2550</li>
<li>既定値：400</li>
</ul>
</li>
<li>tolerance<ul>
<li>定義：到達判定の閾値（弧度）</li>
<li>既定値：0.1</li>
<li>説明：目標角度（弧度）と差が tolerance 以下になると、到達だと判断する。</li>
</ul>
</li>
<li>戻り値<ul>
<li>定義：移動命令 <a href="usage_cubehandle.html#22-Movement-%E6%A7%8B%E9%80%A0%E4%BD%93">（Movement）</a></li>
</ul>
</li>
</ul>



</body></html>
